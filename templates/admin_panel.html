{% extends 'base.html' %}
{% block title %}Panel de Administraci√≥n{% endblock %}

{% block content %}
<h1>Panel de Administraci√≥n</h1>

<hr/>

{# 1) Crear Nuevo Documento de Ayuda #}
<section>
  <h2>Crear Nuevo Documento de Ayuda</h2>
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="card" style="padding:1rem; margin-bottom:1rem;">
      {{ help_doc_form.non_field_errors }}
      <p>
        {{ help_doc_form.title.label_tag }}<br>
        {{ help_doc_form.title }}<br>
        {{ help_doc_form.title.errors }}
      </p>
      <p>
        {{ help_doc_form.file.label_tag }}<br>
        {{ help_doc_form.file }}<br>
        {{ help_doc_form.file.errors }}
      </p>
      <p>
        {{ help_doc_form.tags.label_tag }}<br>
        {{ help_doc_form.tags }}<br>
        {{ help_doc_form.tags.errors }}
      </p>
      <button type="submit" name="create_helpdoc" class="btn">Crear Documento de Ayuda</button>
    </div>
  </form>
</section>

<hr/>

{# 2) Gestionar Documentos de Ayuda (paginados) #}
<section>
  <h2>Gestionar Documentos de Ayuda</h2>
  {% for tag in tags %}
  <details style="margin-bottom:0.5rem;">
    <summary style="cursor:pointer; font-weight:bold;">
      {{ tag.name }}
    </summary>
    <ul style="margin-left:1.5rem; margin-top:0.5rem;">
      {% for hd in help_docs %}
        {% if tag in hd.tags.all %}
        <li style="margin-bottom:0.5rem;">
          <strong>{{ hd.title }}</strong>
          {% if hd.file %}
            <br><a href="{{ hd.file.url }}" target="_blank">Descargar/Ver Archivo</a>
          {% endif %}
          <form method="POST" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="delete_helpdoc_id" value="{{ hd.id }}">
            <button type="submit" class="btn-trash" title="Eliminar">üóëÔ∏è</button>
          </form>
        </li>
        {% endif %}
      {% endfor %}
    </ul>
  </details>
  {% endfor %}

  {# Navegaci√≥n de p√°gi¬≠nas #}
  {% if help_docs.has_other_pages %}
  <nav style="margin:1rem 0; text-align:center;">
    {% if help_docs.has_previous %}
      <a href="?page={{ help_docs.previous_page_number }}">¬´ Anterior</a>
    {% endif %}
    P√°gina {{ help_docs.number }} de {{ help_docs.paginator.num_pages }}
    {% if help_docs.has_next %}
      <a href="?page={{ help_docs.next_page_number }}">Siguiente ¬ª</a>
    {% endif %}
  </nav>
  {% endif %}
</section>

<hr/>

{# 3) Crear Nuevo Tag #}
<section>
  <h2>Crear Nuevo Tag</h2>
  <form method="POST">
    {% csrf_token %}
    <div class="card" style="padding:1rem; margin-bottom:1rem;">
      {{ tag_form.non_field_errors }}
      {{ tag_form.name.label_tag }}<br>
      {{ tag_form.name }}<br>
      {{ tag_form.name.errors }}
      <button type="submit" name="create_tag" class="btn">Crear Tag</button>
    </div>
  </form>
</section>

<hr/>

{# 4) Gestionar Tags #}
<section>
  <h2>Gestionar Tags</h2>
  <details>
    <summary style="cursor:pointer; font-weight:bold;">
      Ver/Eliminar Tags
    </summary>
    <ul style="margin-left:1.5rem; margin-top:0.5rem;">
      {% for tg in tags %}
      <li style="margin-bottom:0.5rem;">
        {{ tg.name }}
        <form method="POST" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="delete_tag_id" value="{{ tg.id }}">
          <button type="submit" class="btn-trash" title="Eliminar">üóëÔ∏è</button>
        </form>
      </li>
      {% empty %}
      <li>No hay tags.</li>
      {% endfor %}
    </ul>
  </details>
</section>

<hr/>

{# 5) Crear Nueva FAQ #}
<section>
  <h2>Crear Nueva FAQ</h2>
  <form method="POST">
    {% csrf_token %}
    <div class="card" style="padding:1rem; margin-bottom:1rem;">
      {{ faq_form.non_field_errors }}
      <p>
        {{ faq_form.question.label_tag }}<br>
        {{ faq_form.question }}<br>
        {{ faq_form.question.errors }}
      </p>
      <p>
        {{ faq_form.answer.label_tag }}<br>
        {{ faq_form.answer }}<br>
        {{ faq_form.answer.errors }}
      </p>
      <button type="submit" name="create_faq" class="btn">Crear FAQ</button>
    </div>
  </form>
</section>

<hr/>

{# 6) Gestionar FAQs #}
<section>
  <h2>Gestionar FAQs</h2>
  <details>
    <summary style="cursor:pointer; font-weight:bold;">
      Ver/Eliminar FAQs
    </summary>
    <ul style="margin-left:1.5rem; margin-top:0.5rem;">
      {% for faq in faqs_list %}
      <li style="margin-bottom:0.5rem;">
        <strong>{{ faq.question }}</strong><br>
        {{ faq.answer }}<br>
        <form method="POST" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="delete_faq_id" value="{{ faq.id }}">
          <button type="submit" class="btn-trash" title="Eliminar">üóëÔ∏è</button>
        </form>
      </li>
      {% empty %}
      <li>No hay FAQs.</li>
      {% endfor %}
    </ul>
  </details>
</section>

<hr/>

{# 7) Bot√≥n Cerrar Sesi√≥n #}
<div style="margin-top:2rem;">
  <form action="{% url 'logout' %}" method="post">
    {% csrf_token %}
    <button type="submit" class="btn">Cerrar Sesi√≥n</button>
  </form>
</div>

{% endblock %}
