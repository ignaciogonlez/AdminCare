{% extends 'base.html' %}
{% block title %}Panel de Administraci√≥n{% endblock %}

{% block content %}
<h1>Panel de Administraci√≥n</h1>

<hr/>

{# 1) Formulario Crear Documento de Ayuda #}
<section>
  <h2>Crear Nuevo Documento de Ayuda</h2>
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="card" style="padding:1rem; margin-bottom:1rem;">

      {# Errores no asociados a un campo concreto #}
      {% if help_doc_form.non_field_errors %}
        <ul class="errorlist">
          {% for err in help_doc_form.non_field_errors %}
            <li>{{ err }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      <p>
        {{ help_doc_form.title.label_tag }}<br>
        {{ help_doc_form.title }}
        {% if help_doc_form.title.errors %}
          <ul class="errorlist">
            {% for err in help_doc_form.title.errors %}
              <li>{{ err }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </p>
      <p>
        {{ help_doc_form.file.label_tag }}<br>
        {{ help_doc_form.file }}
        {% if help_doc_form.file.errors %}
          <ul class="errorlist">
            {% for err in help_doc_form.file.errors %}
              <li>{{ err }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </p>
      <p>
        {{ help_doc_form.tags.label_tag }}<br>
        {{ help_doc_form.tags }}
        {% if help_doc_form.tags.errors %}
          <ul class="errorlist">
            {% for err in help_doc_form.tags.errors %}
              <li>{{ err }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </p>

      <button type="submit" name="create_helpdoc" class="btn">Crear Documento de Ayuda</button>
    </div>
  </form>
</section>

<hr/>

{# 2) Desplegables para Documentos de Ayuda por etiqueta #}
<section>
  <h2>Gestionar Documentos de Ayuda</h2>
  {% for tag in tags %}
  <details style="margin-bottom:0.5rem;">
    <summary style="cursor:pointer; font-weight:bold;">
      {{ tag.name }}
    </summary>
    <ul style="margin-left:1.5rem; margin-top:0.5rem;">
      {% for hd in help_docs %}
        {% if tag in hd.tags.all %}
        <li style="margin-bottom:0.5rem;">
          <strong>{{ hd.title }}</strong>
          {% if hd.file %}<br>
            <a href="{{ hd.file.url }}" target="_blank">Descargar/Ver Archivo</a>
          {% endif %}
          <form method="POST" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="delete_helpdoc_id" value="{{ hd.id }}">
            <button type="submit" class="btn-trash" title="Eliminar">üóëÔ∏è</button>
          </form>
        </li>
        {% endif %}
      {% endfor %}
    </ul>
  </details>
  {% endfor %}
</section>

<hr/>

{# 3) Formulario Crear Tag #}
<section>
  <h2>Crear Nuevo Tag</h2>
  <form method="POST">
    {% csrf_token %}
    <div class="card" style="padding:1rem; margin-bottom:1rem;">

      {{ tag_form.non_field_errors }}
      {{ tag_form.name.label_tag }}<br>
      {{ tag_form.name }}
      {{ tag_form.name.errors }}

      <button type="submit" name="create_tag" class="btn">Crear Tag</button>
    </div>
  </form>
</section>

<hr/>

{# 4) Desplegable lista de Tags #}
<section>
  <h2>Gestionar Tags</h2>
  <details>
    <summary style="cursor:pointer; font-weight:bold;">
      Ver/Eliminar Tags
    </summary>
    <ul style="margin-left:1.5rem; margin-top:0.5rem;">
      {% for tg in tags %}
      <li style="margin-bottom:0.5rem;">
        {{ tg.name }}
        <form method="POST" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="delete_tag_id" value="{{ tg.id }}">
          <button type="submit" class="btn-trash" title="Eliminar">üóëÔ∏è</button>
        </form>
      </li>
      {% empty %}
      <li>No hay tags.</li>
      {% endfor %}
    </ul>
  </details>
</section>

<hr/>

{# 5) Formulario Crear FAQ #}
<section>
  <h2>Crear Nueva FAQ</h2>
  <form method="POST">
    {% csrf_token %}
    <div class="card" style="padding:1rem; margin-bottom:1rem;">

      {{ faq_form.non_field_errors }}
      <p>
        {{ faq_form.question.label_tag }}<br>
        {{ faq_form.question }}
        {{ faq_form.question.errors }}
      </p>
      <p>
        {{ faq_form.answer.label_tag }}<br>
        {{ faq_form.answer }}
        {{ faq_form.answer.errors }}
      </p>

      <button type="submit" name="create_faq" class="btn">Crear FAQ</button>
    </div>
  </form>
</section>

<hr/>

{# 6) Desplegable lista de FAQs #}
<section>
  <h2>Gestionar FAQs</h2>
  <details>
    <summary style="cursor:pointer; font-weight:bold;">
      Ver/Eliminar FAQs
    </summary>
    <ul style="margin-left:1.5rem; margin-top:0.5rem;">
      {% for faq in faqs_list %}
      <li style="margin-bottom:0.5rem;">
        <strong>{{ faq.question }}</strong><br>
        {{ faq.answer }}<br>
        <form method="POST" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="delete_faq_id" value="{{ faq.id }}">
          <button type="submit" class="btn-trash" title="Eliminar">üóëÔ∏è</button>
        </form>
      </li>
      {% empty %}
      <li>No hay FAQs.</li>
      {% endfor %}
    </ul>
  </details>
</section>

<hr/>

{# 7) Bot√≥n Cerrar Sesi√≥n #}
<div style="margin-top:2rem;">
  <form action="{% url 'logout' %}" method="post">
    {% csrf_token %}
    <button type="submit" class="btn">Cerrar Sesi√≥n</button>
  </form>
</div>

{% endblock %}
